{% extends "layout.html" %}

{% block title %}Profile - Community Helper Hub{% endblock %}

{% block additional_css %}
<style>
    .profile-container {
        max-width: 800px;
        margin: 2rem auto;
        padding: 0 1rem;
    }

    .profile-header {
        background: var(--color-card-bg);
        border-radius: var(--radius-lg);
        padding: 2rem;
        margin-bottom: 2rem;
        text-align: center;
        box-shadow: var(--shadow-md);
        border: 1px solid var(--color-card-border);
    }

    .profile-avatar {
        width: 120px;
        height: 120px;
        border-radius: 50%;
        object-fit: cover;
        margin: 0 auto 1rem;
        border: 4px solid var(--color-bg-accent);
    }

    .profile-form {
        background: var(--color-card-bg);
        border-radius: var(--radius-lg);
        padding: 2rem;
        box-shadow: var(--shadow-md);
        border: 1px solid var(--color-card-border);
    }

    .form-section {
        margin-bottom: 2rem;
        padding-bottom: 1.5rem;
        border-bottom: 1px solid var(--color-border);
    }

    .form-section:last-child {
        border-bottom: none;
        margin-bottom: 0;
    }

    .section-title {
        font-size: 1.25rem;
        font-weight: 600;
        margin-bottom: 1rem;
        color: var(--color-text-primary);
    }

    .form-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1rem;
    }

    .form-group-full {
        grid-column: 1 / -1;
    }

    @media (max-width: 768px) {
        .form-grid {
            grid-template-columns: 1fr;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="profile-container">
    <div class="profile-header">
        <div class="profile-avatar">
            {% if user.profile_picture %}
            <img src="{{ url_for('static', filename='uploads/' + user.profile_picture) }}" alt="Profile Picture">
            {% else %}
            <i class="fas fa-user-circle fa-5x" style="color: var(--color-text-tertiary);"></i>
            {% endif %}
        </div>
        <h2>{{ user.name }}</h2>
        <p class="text-muted">{{ user.email }}</p>
        <span
            class="badge badge-{{ 'primary' if user.user_type == 'user' else 'success' if user.user_type == 'helper' else 'warning' }}">
            {{ user.user_type.title() }}
        </span>
    </div>

    <form method="POST" action="{{ url_for('auth.update_profile') }}" class="profile-form">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
        <div class="form-section">
            <h3 class="section-title">Personal Information</h3>
            <div class="form-grid">
                <div class="form-group">
                    <label for="name">Full Name</label>
                    <input type="text" id="name" name="name" value="{{ user.name }}" required class="form-control">
                </div>

                <div class="form-group">
                    <label for="email">Email</label>
                    <input type="email" id="email" name="email" value="{{ user.email }}" readonly class="form-control"
                        style="background-color: var(--color-bg-muted);">
                    <small class="form-text text-muted">Email cannot be changed</small>
                </div>

                <div class="form-group">
                    <label for="phone">Phone Number</label>
                    <input type="tel" id="phone" name="phone" value="{{ user.phone or '' }}" class="form-control">
                </div>

                <div class="form-group form-group-full">
                    <label for="address">Address</label>
                    <textarea id="address" name="address" rows="3"
                        class="form-control">{{ user.address or '' }}</textarea>
                </div>
            </div>
        </div>

        {% if user.user_type == 'helper' and helper_profile %}
        <div class="form-section">
            <h3 class="section-title">Helper Information</h3>
            <div class="form-grid">
                <div class="form-group form-group-full">
                    <label for="skills">Skills</label>
                    <input type="text" id="skills" name="skills" value="{{ helper_profile.skills }}"
                        class="form-control" placeholder="e.g., Plumbing, Electrical, Carpentry">
                </div>

                <div class="form-group">
                    <label for="experience">Years of Experience</label>
                    <input type="number" id="experience" name="experience" value="{{ helper_profile.experience or 0 }}"
                        min="0" class="form-control">
                </div>

                <div class="form-group">
                    <label for="availability">Availability</label>
                    <select id="availability" name="availability" class="form-control">
                        <option value="weekdays" {{ 'selected' if helper_profile.availability=='weekdays' else '' }}>
                            Weekdays</option>
                        <option value="weekends" {{ 'selected' if helper_profile.availability=='weekends' else '' }}>
                            Weekends</option>
                        <option value="both" {{ 'selected' if helper_profile.availability=='both' else '' }}>Both
                        </option>
                    </select>
                </div>

                <div class="form-group form-group-full">
                    <div class="d-flex justify-content-between align-items-center">
                        <span>Verification Status:</span>
                        <span class="badge badge-{{ 'success' if helper_profile.verified else 'warning' }}">
                            {{ 'Verified' if helper_profile.verified else 'Pending' }}
                        </span>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}

        <div class="d-flex justify-content-between">
            <a href="{{ url_for('user.dashboard') if user.user_type == 'user' else url_for('helper.dashboard') if user.user_type == 'helper' else url_for('admin.dashboard') }}"
                class="btn btn-secondary">
                <i class="fas fa-arrow-left"></i> Back to Dashboard
            </a>
            <button type="submit" class="btn btn-primary">
                <i class="fas fa-save"></i> Update Profile
            </button>
        </div>
    </form>
</div>
{% endblock %}