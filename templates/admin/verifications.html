{% extends "layout.html" %}

{% block title %}Admin - Verifications{% endblock %}

{% block styles %}
<style>
    .admin-container {
        display: flex;
        min-height: calc(100vh - 60px);
    }
    
    .admin-sidebar {
        width: 250px;
        background-color: var(--color-card-bg);
        border-right: 1px solid var(--color-border);
        padding: 1.5rem 1rem;
    }
    
    .admin-sidebar .admin-profile {
        display: flex;
        align-items: center;
        margin-bottom: 2rem;
        padding-bottom: 1rem;
        border-bottom: 1px solid var(--color-border);
    }
    
    .admin-sidebar .admin-profile img {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        object-fit: cover;
        margin-right: 1rem;
    }
    
    .admin-sidebar .admin-profile .admin-info h3 {
        margin: 0;
        font-size: 1rem;
    }
    
    .admin-sidebar .admin-profile .admin-info p {
        margin: 0;
        font-size: 0.8rem;
        color: var(--color-text-muted);
    }
    
    .admin-sidebar .admin-nav {
        list-style: none;
        padding: 0;
        margin: 0;
    }
    
    .admin-sidebar .admin-nav li {
        margin-bottom: 0.5rem;
    }
    
    .admin-sidebar .admin-nav a {
        display: flex;
        align-items: center;
        padding: 0.75rem 1rem;
        border-radius: 0.5rem;
        color: var(--color-text);
        text-decoration: none;
        transition: all 0.2s;
    }
    
    .admin-sidebar .admin-nav a:hover {
        background-color: var(--color-bg-hover);
    }
    
    .admin-sidebar .admin-nav a.active {
        background-color: var(--color-primary);
        color: white;
    }
    
    .admin-sidebar .admin-nav a i {
        margin-right: 0.75rem;
        font-size: 1.2rem;
    }
    
    .admin-content {
        flex: 1;
        padding: 2rem;
        background-color: var(--color-bg);
        overflow-y: auto;
    }
    
    .admin-content h1 {
        margin-top: 0;
        margin-bottom: 1.5rem;
        font-size: 1.8rem;
    }
    
    .filter-bar {
        display: flex;
        align-items: center;
        margin-bottom: 1.5rem;
        padding: 1rem;
        background-color: var(--color-card-bg);
        border-radius: 0.5rem;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    }
    
    .filter-bar .filter-item {
        margin-right: 1rem;
    }
    
    .filter-bar .filter-item label {
        display: block;
        margin-bottom: 0.25rem;
        font-size: 0.8rem;
        color: var(--color-text-muted);
    }
    
    .filter-bar .filter-item select,
    .filter-bar .filter-item input {
        padding: 0.5rem;
        border: 1px solid var(--color-border);
        border-radius: 0.25rem;
        background-color: var(--color-input-bg);
        color: var(--color-text);
    }
    
    .filter-bar .search-box {
        flex: 1;
        position: relative;
    }
    
    .filter-bar .search-box input {
        width: 100%;
        padding-left: 2.5rem;
    }
    
    .filter-bar .search-box i {
        position: absolute;
        left: 0.75rem;
        top: 50%;
        transform: translateY(-50%);
        color: var(--color-text-muted);
    }
    
    .verification-table {
        width: 100%;
        border-collapse: collapse;
        background-color: var(--color-card-bg);
        border-radius: 0.5rem;
        overflow: hidden;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    }
    
    .verification-table th,
    .verification-table td {
        padding: 1rem;
        text-align: left;
        border-bottom: 1px solid var(--color-border);
    }
    
    .verification-table th {
        background-color: var(--color-bg-alt);
        font-weight: 600;
    }
    
    .verification-table tr:last-child td {
        border-bottom: none;
    }
    
    .verification-table .helper-info {
        display: flex;
        align-items: center;
    }
    
    .verification-table .helper-info img {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        object-fit: cover;
        margin-right: 0.75rem;
    }
    
    .verification-table .helper-info .helper-details h4 {
        margin: 0;
        font-size: 1rem;
    }
    
    .verification-table .helper-info .helper-details p {
        margin: 0;
        font-size: 0.8rem;
        color: var(--color-text-muted);
    }
    
    .verification-table .status {
        display: inline-block;
        padding: 0.25rem 0.75rem;
        border-radius: 1rem;
        font-size: 0.8rem;
        font-weight: 500;
    }
    
    .verification-table .status.pending {
        background-color: rgba(255, 193, 7, 0.2);
        color: #ffc107;
    }
    
    .verification-table .status.verified {
        background-color: rgba(40, 167, 69, 0.2);
        color: #28a745;
    }
    
    .verification-table .status.rejected {
        background-color: rgba(220, 53, 69, 0.2);
        color: #dc3545;
    }
    
    .verification-table .actions {
        display: flex;
        gap: 0.5rem;
    }
    
    .verification-table .actions a {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 36px;
        height: 36px;
        border-radius: 50%;
        background-color: var(--color-bg-alt);
        color: var(--color-text);
        text-decoration: none;
        transition: all 0.2s;
    }
    
    .verification-table .actions a:hover {
        background-color: var(--color-primary);
        color: white;
    }
    
    .pagination {
        display: flex;
        justify-content: center;
        margin-top: 2rem;
        gap: 0.5rem;
    }
    
    .pagination a,
    .pagination span {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 36px;
        height: 36px;
        border-radius: 50%;
        background-color: var(--color-card-bg);
        color: var(--color-text);
        text-decoration: none;
        transition: all 0.2s;
    }
    
    .pagination a:hover {
        background-color: var(--color-bg-hover);
    }
    
    .pagination span.current {
        background-color: var(--color-primary);
        color: white;
    }
    
    .pagination span.ellipsis {
        background-color: transparent;
    }
    
    @media (max-width: 768px) {
        .admin-container {
            flex-direction: column;
        }
        
        .admin-sidebar {
            width: 100%;
            border-right: none;
            border-bottom: 1px solid var(--color-border);
            padding: 1rem;
        }
        
        .filter-bar {
            flex-direction: column;
            align-items: stretch;
        }
        
        .filter-bar .filter-item {
            margin-right: 0;
            margin-bottom: 1rem;
        }
        
        .verification-table .helper-info img {
            display: none;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="admin-container">
    <aside class="admin-sidebar">
        <div class="admin-profile">
            <img src="{{ session.user.profile_picture or '/static/images/default-avatar.png' }}" alt="Admin Profile">
            <div class="admin-info">
                <h3>{{ session.user.name }}</h3>
                <p>Administrator</p>
            </div>
        </div>
        
        <ul class="admin-nav">
            <li><a href="{{ url_for('admin.dashboard') }}">
                <i class="fas fa-tachometer-alt"></i> Dashboard
            </a></li>
            <li><a href="{{ url_for('admin.users') }}">
                <i class="fas fa-users"></i> Users
            </a></li>
            <li><a href="{{ url_for('admin.helpers') }}">
                <i class="fas fa-hands-helping"></i> Helpers
            </a></li>
            <li><a href="{{ url_for('admin.verifications') }}" class="active">
                <i class="fas fa-user-check"></i> Verifications
            </a></li>
            <li><a href="{{ url_for('admin.requests') }}">
                <i class="fas fa-clipboard-list"></i> Requests
            </a></li>
            <li><a href="{{ url_for('admin.complaints') }}">
                <i class="fas fa-exclamation-circle"></i> Complaints
            </a></li>
            <li><a href="{{ url_for('admin.feedback') }}">
                <i class="fas fa-star"></i> Feedback
            </a></li>
            <li><a href="{{ url_for('admin.profile') }}">
                <i class="fas fa-user-cog"></i> My Profile
            </a></li>
            <li><a href="{{ url_for('admin.settings') }}">
                <i class="fas fa-cog"></i> Settings
            </a></li>
        </ul>
    </aside>
    
    <main class="admin-content">
        <h1>Helper Verifications</h1>
        
        <div class="filter-bar">
            <div class="filter-item">
                <label for="status-filter">Status</label>
                <select id="status-filter" name="status">
                    <option value="all" {% if request.args.get('status') == 'all' or not request.args.get('status') %}selected{% endif %}>All</option>
                    <option value="Pending" {% if request.args.get('status') == 'Pending' %}selected{% endif %}>Pending</option>
                    <option value="Verified" {% if request.args.get('status') == 'Verified' %}selected{% endif %}>Verified</option>
                    <option value="Rejected" {% if request.args.get('status') == 'Rejected' %}selected{% endif %}>Rejected</option>
                </select>
            </div>
            
            <div class="search-box">
                <i class="fas fa-search"></i>
                <input type="text" id="search-input" name="search" placeholder="Search by name or email" value="{{ request.args.get('search', '') }}">
            </div>
        </div>
        
        <table class="verification-table">
            <thead>
                <tr>
                    <th>Helper</th>
                    <th>Document Type</th>
                    <th>Submitted</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for verification in verifications %}
                <tr>
                    <td>
                        <div class="helper-info">
                            <img src="{{ helper.user.profile_picture or '/static/images/default-avatar.png' }}" alt="Helper Profile">
                            <div class="helper-details">
                                <h4>{{ helper.user.name }}</h4>
                                <p>{{ helper.user.email }}</p>
                            </div>
                        </div>
                    </td>
                    <td>{{ verification.document_type }}</td>
                    <td>{{ verification.created_at }}</td>
                    <td>
                        <span class="status {{ verification.status.lower() }}">{{ verification.status }}</span>
                    </td>
                    <td class="actions">
                        <a href="{{ url_for('admin.verification_review', verification_id=verification.id) }}" title="Review">
                            <i class="fas fa-eye"></i>
                        </a>
                    </td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="5" class="text-center">No verifications found</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        
        {% if total_pages > 1 %}
        <div class="pagination">
            {% if current_page > 1 %}
            <a href="{{ url_for('admin.verifications', page=current_page-1, status=request.args.get('status', 'all'), search=request.args.get('search', '')) }}">
                <i class="fas fa-chevron-left"></i>
            </a>
            {% endif %}
            
            {% for page in pages %}
                {% if page == '...' %}
                <span class="ellipsis">{{ page }}</span>
                {% elif page == current_page %}
                <span class="current">{{ page }}</span>
                {% else %}
                <a href="{{ url_for('admin.verifications', page=page, status=request.args.get('status', 'all'), search=request.args.get('search', '')) }}">
                    {{ page }}
                </a>
                {% endif %}
            {% endfor %}
            
            {% if current_page < total_pages %}
            <a href="{{ url_for('admin.verifications', page=current_page+1, status=request.args.get('status', 'all'), search=request.args.get('search', '')) }}">
                <i class="fas fa-chevron-right"></i>
            </a>
            {% endif %}
        </div>
        {% endif %}
    </main>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Handle filter changes
        const statusFilter = document.getElementById('status-filter');
        const searchInput = document.getElementById('search-input');
        
        statusFilter.addEventListener('change', applyFilters);
        
        // Apply filters with debounce for search
        let searchTimeout;
        searchInput.addEventListener('input', function() {
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(applyFilters, 500);
        });
        
        function applyFilters() {
            const status = statusFilter.value;
            const search = searchInput.value.trim();
            
            let url = new URL(window.location.href);
            url.searchParams.set('status', status);
            
            if (search) {
                url.searchParams.set('search', search);
            } else {
                url.searchParams.delete('search');
            }
            
            url.searchParams.set('page', 1); // Reset to first page on filter change
            
            window.location.href = url.toString();
        }
    });
</script>
{% endblock %}